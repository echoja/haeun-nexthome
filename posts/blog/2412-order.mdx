---
title: "주문서 마이그레이션 회고 (작성중)"
date: 2024-12-25 10:00
tags:
- Next.js
- 마이그레이션
- 회고
description: 머스트잇 주문서 Vue2에서 Next 15로 마이그레이션하기
---

하반기 회사에서 했던 것 중 가장 뿌듯했고 공을 많이 들였던 프로젝트가 끝났다. 
바로 '주문서 마이그레이션 및 개선' 프로젝트인데,
 **vue 2로 되어있던 주문서를 Next.js 15**로 마이그레이션했다. 

![팀 리드와의 대화](/images/blog/24/order-chat.webp)

### 발단

**원래 주문서는 vue + nuxt**로 되어있었다. 
본격적으로 시간과 인력을 할당받아하는 게 아니었고 프로젝트 중간중간 room이 생길때 팀 내부적으로 하기로 했었다. 
그렇기에 기술 스택을 유지하면서 리팩토링과 주문서 내 렌더링 개선, 버그만 수정하기로 했었다. 
주문서는 복잡한 로직이 있고 결제가 엮여있는 이커머스의 핵심 기능이기에 팀에서도 잘 못 건드리고 있던 부분인데, 
성능이 안 좋았고 개선의 여지가 많았다. 
그래서 이런 코어이면서도 레거시인 코드를 리팩토링해보고 싶어서 팀 리드한테 먼저 하고 싶다고 말했고, 동료 팀원 한 명과 하게 되었다.

### 테스트 코드를 짠 이유

주문서 코드를 건들기에 앞서 테스트 코드를 무조건 작성해야한다고 생각했다. 
이유는 가격/할인/쿠폰/배송 등 복잡한 비즈니스 및 계산 로직이 있어 리스크가 큰 작업이었고, 
리팩토링을 하기 전후 무조건 똑같이 동작해야한다고 생각했기 때문이다.

![tc.png](/images/blog/24/order-tc.webp)

기존 vue 주문서는 테스트 케이스(TC)가 기획 부서에도, 개발 부서에도 없었기 때문에 내가 직접 작성했다. 
주문서를 다 만져보고 눌러보면서 작성했다. 로그인 여부에 따라 달라지는 로직도 있고 
상품 쿠폰, 판매자 쿠폰, 적립금, 상품권 등 고려할 게 많았는데
 이 **TC를 작성한 게 주문서의 정책을 파악하는데 꽤 많은 도움**이 됐다.  

### Playwright을 선택한 이유

TC를 기반으로 Playwright 테스트 코드를 작성했다. 
전 회사에서 Cypress로 e2e 테스트를 짰었는데 이번에 Playwright을 선택한 이유는 2가지였다.   


1. cypress 쓸 때 좀 무거운 느낌이 들었었다. 
2. Playwright은 **Google Chrome for Android, Mobile Safari 테스트를 지원**한다. 
반면 [Cypress는 2024년 8월 기준 Safari를 지원하지 않았다](https://docs.cypress.io/guides/guides/launching-browsers#Unsupported-Browsers).
머스트잇 앱은 웹뷰라 Playwright이 테스트하기에 적합하겠단 생각이 들었다.

e2e 테스트를 구현하면서 ~~역시나 노가다~~라는 생각을 하긴 했지만 리팩토링 후
 코드의 신뢰성을 보장해줄 게 테스트 코드뿐이었기 때문에 이 테스트 코드의 가치에는 의심이 전혀 들지 않았다. 

![테스트코드 워크샵](/images/blog/24/order-workshop.webp)

테스트 코드를 다 작성한 이후엔 엔지니어링 리드의 제안으로, **'주문서에 E2E 테스트 끼얹기'**라는 제목의 간단한 발표를 했다. 
e2e 테스트 코드를 작성한 이유와 테스팅 툴 선택과정, 자세한 적용법 등의 내용을 담았다.

테스트 코드를 다 작성해가던 타이밍에, 아예 Next.js로 주문서를 띄워서 
주문서 **진입** 성능부터 개선하자는 팀 내부 의견이 컨펌되어 본격적으로 Next.js로 주문서를 마이그레이션하게 되었다. 
너무너무너무 좋은 기회였다. 

### Next.js 도입

머스트잇 앱은 원래 Vue로 돼있어서 회사 프로젝트에 Next.js를 도입하는 건 처음이었다. 
앞으로 다른 영역들도 Next.js로 전환해야했기에 파일 디렉토리 구조나 로깅 방식 등 글로벌한 의사결정은 팀원 다같이 논의를 했다. 

(작성중...)